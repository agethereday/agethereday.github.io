[{"content":"","date":"2025-08-10T00:00:00Z","permalink":"https://agethereday.github.io/p/%E9%94%80%E5%94%AE%E9%A2%84%E6%B5%8B/","title":"销售预测"},{"content":"项目：EXCEL搭建数据看板 该文章为搭建看板文档，如有错误还望海涵，评论系统还未搭建，如有疑问可通过邮箱联系我。\n明确目标 我们首先要明确搭建数据看板的目标是什么,如：\n部门 用途 看板类型 生产 保障生产效率、质量和成本可控 生产监控，质量管控，成本优化，设备管理 运营 提升业务效率、用户体验和业绩增长 业务流程监控，用户行为分析，业绩目标追踪，市场与竞争分析 财务 确保资金安全、控制财务风险、支撑战略决策 资金与现金流监控，成本与利润分析，预算与实际对比，财务风险预警 我们搭建看板的目的是为了监控生产和分析生产，激励生产的作用。\n确定指标 明确了我们的目标之后，我们需要确认我们所需的指标体系——即用什么可以衡量我们的我们的目的。这里我们以生产质量为例：\n生产质量=产品合格率=（生产总数-不合格数）/生产总数(因为浮点数的原因，不要使用1-不合格率)\n确认看板模块 时间维度：\n日度数据，周度数据，月度数据，季度数据，年度数据\n空间维度：\n个人，小组长，车间，部门，公司 可视化：\n表格，折线图（趋势），饼图（占比），柱状图（比较）\n数据 我们选用CSDN开源的生产数据，数据来源链接我会放业尾。\n对原始数据其如下：\n项目名 生产车间 生产数量 不合格数量 负责人 日期 SC001 一车间 1409 2 王成蕾 2021-1-1 SC002 一车间 733 2 刘杰 2021-1-1 SC003 二车间 1071 1 张博 2021-1-1 SC004 三车间 1435 3 赵丽 2021-1-1 我们日期拆解为年，月和日。我们使用可以使用日期函数和取数函数（取数函数需将日期改为aaaa-bb-cc形式。），我这里使用日期函数。\n1 2 3 4 5 year()#提取年 ceiling(month()/3,1)#提取季度 month()#提取月份 WEEKNUM()#提前周 day()#提前日 处理后结果：\n项目名 生产车间 生产数量 不合格数量 负责人 日期 合格率 月 日 季度 SC001 一车间 1409 2 王成蕾 2021-1-1 99.86% 1 1 1 SC002 一车间 733 2 刘杰 2021-1-1 99.73% 1 1 1 SC003 二车间 1071 1 张博 2021-1-1 99.91% 1 1 1 数据透视表 我们对生产效率出于及时性只考虑到月和日这一层次。通过筛选可以看出负责人负责多个车间，所以行从包含角度来排列，从上到下依次为，日，负责人，车间，项目名字段。值则为生产数量，不合格数量字段。筛选器选用月。\n切片器：切片器是 Excel 中一种强大的数据分析工具，它可以以直观、交互的方式快速筛选数据透视表中的数据。\n插入以月筛选的切片器，通过添加按钮数将其转化为横向。\n1 图表的制作 表 年表： 按项目名汇总生产总量与不合格生产总量。\n1 =SUMIF(Sheet3!$A$2:$A$50001,A2,Sheet3!$C$2:$C$50001)#数据源使用原始数据表 月表： 从分析的角度我们需要将异动进行拆解归因，从我们的现有数据来看可以将其拆解为“人”，“产品”，“厂房”——负责人，项目名，生产车间。不合格数=人+设备+原材料+方法+环境（厂房）\n所以我们需要分别建立月负责人，月项目名，月生产车间。因为我们需要其能按月变动，所以数据源应为数据透视表。\n1 =SUMIF(Sheet4!$C:$C,A20,Sheet4!$F:$F)#月负责人，月项目名，月生产车间都类似 日表：\n月份 =数据透视表的月份 日期 1-31（从1-31号，共31列） 生产数量 =SUMIF(数据透视表!$A:A,B49,数据透视表!$B:B) 不合格数量 =SUMIF(数据透视表!$A:A,B49,数据透视表!$C:C) 合格率 =（生产总数-不合格数）/生产总数 图 日合格率波动图\n行列转化：\n日期 合格率 上限 下限 1 0.997183623 0.997651133 0.996456577 1 ==XLOOKUP(A45,$B$35:$AF$35,$B$38:$AF$38) 异常值计算：\n1 2 3 4 5 Q1=QUARTILE(B38:AF38,1) Q3=QUARTILE(B38:AF38,3) IQR=Q3-Q1 异常上限=Q3+1.5IQR 异常下限=Q1-1.5IQR 纵坐标轴范围：上下限小数点四位+-1\n蓝色虚线为趋势线\n月份天数不同：将31和30加一个空值检验，为空等于一个值即可。\n1 =IF(XLOOKUP(A75,$B$35:$AF$35,$B$38:$AF$38)=\u0026#34;\u0026#34;,B74,XLOOKUP(A75,$B$35:$AF$35,$B$38:$AF$38)) 2 月负责人不合格占比饼图\n数据源为月表中的月负责人表\n3 布局 具体布局思路可以业尾的如何搭建看板链接，或许可以对你有一些启发。\n4 5 数据通过xlookup进行查找即可。\n看板搭建总结 纯excel搭建不够方便，需要操作的太多，数据多有点卡，可视化效果不够好，实时数据可能还需要外部导入，直接从数据库接口获取数据。可以尝试Tableau，Power BI，或excel的power query。\n改进方向 实时动态数据，为起到监控作用，其需要具有实时数据输入功能。\n异动归因，原设计对异动原因无法有效分析。\n异动标准，实时数据的异动标准可能需要历史数据来进行确认，或这用与预测数据和标准数据的偏离度来确认。\n相关链接 感谢CSDN的酸菜鱼土豆大侠，Excel_Note : excel 开源文档\n如何搭建清晰易懂的数据看板？ - 字节跳动数据平台 - 博客园\n","date":"2025-07-10T00:00:00Z","permalink":"https://agethereday.github.io/p/excel%E7%9C%8B%E6%9D%BF%E6%90%AD%E5%BB%BA/","title":"Excel看板搭建"},{"content":"基于贝叶斯优化的XGBOOST二分类财务造假识别的可解释性分析（修改版） 数据集： 数据来源：国泰安或wind\n时间范围： 时间选择距今4-5年，8-12年跨度的上市公司的数据（上市公司平均上市寿命为8-12年，证监会处罚具有滞后性，一般为4-5年。）造假标准为证监会处罚归属于财务造假为准，时间范围从选择的时间起点至今。（最大增加标注准确率）\n空间范围： 全部A股上市公司\n特征选取 理论基础：\n国外：\n舞弊三角论，GONE理论，舞弊风险因子理论\n国内：黄世忠八因和五维识别模型。\n特征：\n财务：选取三大财务报表的所有科目，四大指标\n非财务:会计师事务所变频率，审计费用，O-Score，Z值，WindESG综合得分，公司市值，成长性，资产价值波动性，风险系数，第一大股东持股比率(%)、管理层持股比例，内部控制是否有效、内部控制是否存在缺陷、是否采取整改措施、是否出具内控评价报告结论、是否披露内控评价报告、会计变更次数（可能为“会计变更次数”）、未完成整改个数、缺陷个数，关联交易占营业收入比、是否增发新股上市，客户集中度，情感语调，cpi，人均可支配收入，GDP增速，PMI，缺失值数量，是否st，以前年度是否造假。\n数据分析： 聚类分析（异质性缓解重要） 各行业造假数量分布不同，可按证监会行业先划分后按照业务逻辑进行合并，在合并组内进行KNN聚类处理（可能会出现部分头部或垄断公司）。\n线性关系判断： 二分类因变量 + 连续自变量：用逻辑回归检验 logit 尺度的线性关联：\n\u0026lt;center\u0026gt;logit(*p*)=ln(*p*/(1−*p*) 其中p为 Y=1 （造假）的概率\u0026lt;center\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 import statsmodels.api as sm import pandas as pd # X为连续变量，Y为造假 data = pd.DataFrame({ x= y= }) X = sm.add_constant(data[\u0026#39;X\u0026#39;]) # 添加截距项 model = sm.Logit(data[\u0026#39;Y\u0026#39;], X).fit() print(model.summary()) # 查看系数β1及p值 若(beta_1)的 p 值 \u0026lt; 0.05，拒绝 (beta_1=0) 的原假设，认为 X 与 Y 存在统计显著的线性\n在模型中加入\\(X^2\\)项，若其系数显著，说明存在非线性关系（反证原线性假设不成立）。\n两个二分类变量则用Phi 系数结合卡方检验判断线性关联强度。\n分布分析 概率密度直方图\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import numpy as np import seaborn as sns import matplotlib.pyplot as plt import pandas as pd import math plt.rcParams[\u0026#34;font.family\u0026#34;] = [\u0026#34;SimHei\u0026#34;, \u0026#34;WenQuanYi Micro Hei\u0026#34;, \u0026#34;Heiti TC\u0026#34;] sns.set(font_scale=1.2, style=\u0026#34;whitegrid\u0026#34;) np.random.seed(42) df=pd.read_csv()#文件地址 df1=df[\u0026#34;\u0026#34;:\u0026#34;\u0026#34;]#选取的列名 num_features = df1.shape[1] num_pages=math.ceil(len(num_features)/10) for page in range(num_pages): start_idx= page * 10 end_idx = min((page + 1) * 10, len(num_features)) fig, axes = plt.subplots(2, 5, figsize=(22, 10)) axes = axes.flatten() for i in df1: ax = axes[i] sns.histplot(data=i, kde=True, stat=\u0026#34;density\u0026#34;, bins=30, alpha=0.7, color=\u0026#39;skyblue\u0026#39;, edgecolor=\u0026#39;black\u0026#39;) plt.show() 缺失值处理 缺失比例 首选方法 \u0026gt;50% 删除非关键特征 20%-50% 预测模型填充 \u0026lt;20% 统计量填充+缺失标记 异常值处理 分析异常值的原因，如果不符合逻辑删去，如果是偏态分布则log化，压缩数据。\n再对正态分布的特征进行Z-Score标准化，非正态则使用修正 Z-Score。\n特征构造 相关信息：构造个别特征营业总收入/营业总成本，（应收账款+合同资产）/总资产，利息收入/货币资金，预付账款/总资产，固定资产周转天数，在建工程/总资产\n时间趋势信息：构造滞后特征，滑动窗口，拓展窗口，差分特征。\n纵向信息：构造平均绝对偏差，最大回撤特征\n不平衡数据的处理 采样方法 适用范围 欠采样（SMOTE） 少数类样本分布较均匀，无极端稀疏或孤立点。 过采样（Random Undersampling） 多数类样本存在大量冗余 二者结合（SMOTE + Tomek Links） 类间边界存在大量 “模糊样本对”，需通过删除边界噪声强化类别区分。 逻辑构造 设定规则，挑选出对应负样本与正样本对应 特征筛选 由于XGboost算法计算速度慢，在这里我们先进行初步筛选，删除方差低于阈值，和特征之间高度相关的，在根据内其重要性函数选取一定数量的特征，在进行递归消除来选取特征。XGBoost内嵌评估指标参数并非一定需要，可解释性shap足以胜任，如果筛选后速度仍旧太慢则可改用LightGBM或Catboost。\n算法调优 5折交叉验证 将数据按时间顺序划分为连续的5个区块（折），每次训练集为当前折之前的所有数据，测试集为当前折。确保测试集时间点始终晚于训练集。\n评估指标：\nPA-AUC：PR曲线是以纵轴为Precision，横轴为Recall，通过改变正负的阀值得到不同的Precision和Recall，构成的曲线，AUC是曲线下方的面积。以此来描述模型的表现。 召回率：以实际样本为判断依据，实际为正例的样本中，被预测正确的正例占总实际正例样本的比例。 F2分数：召回率和精确率是一对矛盾的度量，因此需要综合考虑这两个指标，得到一个综合效果最好的模型。但是财务造假对召回率要求较高，普通的二分类评估指标F1并不适合该模型，而F2-Score，在召回率和精确率二者偏向召回率，更适合财务造假模型。 阀值优化（寻找最优F2分数）与贝叶斯超参数调优（寻找最优召回率）\n对于超参数的选取范围可参考过往论文或XGBoost文档。\n可解释性： XGboost：用XGBoost内嵌评估指标参数可以增强模型特征可解释性。权重（Weight）、覆盖率（Cover）和增益（Gain）三个评估指标分别反映特征的分裂频次、信息增益及影响样本数量，量化并排序特征的重要性。\nshap值：SHAP 即 SHapley Additive exPlanations（夏普利加性解释） ，是可解释人工智能（XAI）领域中一种强大的技术。它基于博弈论中的 Shapley 值，用于解释机器学习模型的输出 。\n示例：\n权重 覆盖率 增益 shap单样本变量（用于解释该公司为什么被识别为假） 交互图（用于判别各特征的交互作用，如目前特征量大的情况下并不好用） 相关链接：\nXGBoost 官方文档\nSHAP官方文档\n","date":"2025-06-10T00:00:00Z","image":"https://agethereday.github.io/p/xgboost%E7%9A%84%E8%B4%A2%E5%8A%A1%E9%A3%8E%E9%99%A9%E8%AF%86%E5%88%AB/XGboost%E5%8E%9F%E7%90%86_hu14622169351619167019.jpg","permalink":"https://agethereday.github.io/p/xgboost%E7%9A%84%E8%B4%A2%E5%8A%A1%E9%A3%8E%E9%99%A9%E8%AF%86%E5%88%AB/","title":"Xgboost的财务风险识别"}]